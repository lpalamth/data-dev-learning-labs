
# <center>VISUALIZING CSV FILE USING TABLEAU</center>

<b>Executed on</b>: Hadoop Big Data Platform

<b>Visualization tool used</b>: Tableau


## OVERVIEW

This learning lab can be used as a guide to get a high level understanding on how to visualise a CSV(Comma Seperated Values) file from Data Learning Platform (DLP) using Tableau.We will be using DevNet Data Learning Platform referred as "DLP" during the course.


## PRE-REQUISITES

1.	Install Chrome Browser.

2.	Obtain access to the Data Learning Platform by creating an account at https://devnetsandbox.cisco.com/RM/Diagram/Index/d8b9476d-cb6f-4b44-a236-b8ebdb3d3ef9?diagramType=Topology(Detailed instructions given below)

3. Input file in CSV (Comma Seperated Values) format<br>

4. The file must have a header line, which names each data column.<br>

5. The file size should be smaller than 50 MB.<br>


## LEARNING OBJECTIVES

1. To get familiarized with the DLP (Data Learning Platform).

2. To get familiarized with the ways to get data from a file. 

3. To get familiarized with the ways to use preloaded network data from HDFS platform and analyse the same to check how many UDP(User Datagram Protocol) and ICMP(Internet control message protocol) packages have been received in each second.

3. To get familiarized with data visualization using Tableau.


## TERMINOLOGIES USED


### TABLEAU - AN INTRODUCTION

Tableau is a powerful business intelligence and analytics tool. There are mainly five main products catering to diverse visualization needs for professionals and organizations. They are:

Tableau Desktop: Made for individual use
Tableau Server: Collaboration for any organization
Tableau Online: Business Intelligence in the Cloud
Tableau Reader: Let you read files saved in Tableau Desktop.
Tableau Public: For journalists or anyone to publish interactive data online.

Tableau Desktop is a data visualization application that lets you analyze virtually any type of structured data and produce highly interactive, beautiful graphs, dashboards, and reports. You can connect to virtually any data source from spreadsheets to data warehouses and display information in multiple graphic perspectives. 

For more details, please refer : 
http://www.tableau.com/learn/training
https://community.tableau.com/welcome


### DLP - AN INTRODUCTION ###

The DevNet Data Learning Platform (DLP) is an integrated data platform from CISCO that includes an easy-to-use UI, Docker-    based infrastructure, best-in-class open-source big-data components, and Cisco’s APIs and tools for data developers and data  scientists who want to develop, validate and provision their solutions before deploying or to explore, analyze, and    visualize their data. The DLP environment comes with an inbuilt cloud based IDE (Integrated Development Environment) built    on Hadoop.

For more details, please refer:
https://developer.cisco.com/site/dlp/docs/overview/

## PROCESS OVERVIEW 

![alt-tag](https://github.com/lpalamth/data-dev-learning-labs/blob/master/labs/word-count-using-spark/assets/images/process.jpeg?raw=true)

Please follow the steps given below to launch the workspace and execute the lab.

###### Step 1: 

Login to DLP (Data Learning Platform)- https://devnetsandbox.cisco.com/RM/Diagram/Index/d8b9476d-cb6f-4b44-a236-b8ebdb3d3ef9?diagramType=Topology by giving the login credentials if the account is already created, else, click on “Register now” button and create a new login profile. The screen shown on click of url is as follows:
If login credentials exist, login by providing the user id and password:
  
![alt-tag](https://github.com/lpalamth/data-dev-learning-labs/blob/master/labs/word-count-using-spark/assets/images/Login Page_1.jpeg?raw=true)

If accessing for the first time, please register and create a new profile:

![alt-tag](https://github.com/lpalamth/data-dev-learning-labs/blob/master/labs/word-count-using-spark/assets/images/Register.jpeg?raw=true)


###### Step 2: 

After logging in, user will be directed to the sandbox UI as shown in the screen below:

![alt-tag](https://github.com/lpalamth/data-dev-learning-labs/blob/master/labs/word-count-using-spark/assets/images/Sandbox Lab.jpeg?raw=true)

###### Step 3:

User needs to click on the Reserve button shown in sandbox page as shown in the screenshot below:
![alt-tag](https://github.com/lpalamth/data-dev-learning-labs/blob/master/labs/word-count-using-spark/assets/images/Sandbox Lab.jpeg?raw=true)

###### Step 4:

On click of reserve button, a pop up window is shown with the details as shown below:
![alt-tag](https://github.com/lpalamth/data-dev-learning-labs/blob/master/labs/word-count-using-spark/assets/images/Reserve_page1.jpeg?raw=true)

###### Step 5:

On click of Reserve button on the pop up window, user would receive an email on registered email ID with the login credentials. The email format would be as shown below:

![alt-tag](https://github.com/lpalamth/data-dev-learning-labs/blob/master/labs/word-count-using-spark/assets/images/email_2.jpeg?raw=true)

###### Step 6:

User needs to click on the link given in the email. On click of the link, the following page would be shown to the user.

Supply the credentials recieved with the email and click on “Login”.

![alt-tag](https://github.com/lpalamth/data-dev-learning-labs/blob/master/labs/word-count-using-spark/assets/images/dlp login page.jpeg?raw=true)


###### Step 7:

On login, user would be directed to the DevNet DLP (Data Learning Platform) as shown in the screenshot below:

![alt-tag](https://github.com/lpalamth/data-dev-learning-labs/blob/master/labs/data-explore-using-zeppelin/assets/Trial1.jpeg?raw=true)

###### Step 8:

Select the file <b>(bank-full.csv)</b> and click on the <b>Drill</b> button shown on top-right corner of the screen as shown in screenshot below:

![alt-tag](https://github.com/lpalamth/data-dev-learning-labs/blob/master/labs/data-explore-using-zeppelin/assets/Zeppelin2.jpeg?raw=true)

Select the data file and then click the **Visualise** button on
Pre-loaded network-origin.csv file is available in DLP's hadoop environment for visualisation.
![Selecting data to visualize](https://github.com/CiscoDevNet/data-dev-learning-labs/blob/master/labs/vizualize-csv-tableau/assets/images/select_data_in_repo.png?raw=true)

**Step 2**.  For the first time use, user's browser may block to open Tableau. Below image is showing that the browser is blocking Tableau to open.
![alt-img](https://github.com/CiscoDevNet/data-dev-learning-labs/blob/master/labs/vizualize-csv-tableau/assets/images/DataVisualizationTablueBrowserBlockingMsg1.PNG?raw=true)

In this case, user has to follow below steps to allow browser and open Tableau in another tab. 

	1. Click the pop-up blocker icon in the browser's address bar. 
	2. Click and Select Always allow pop-ups from "http://xx.xx.xx.xx"
	3. Click the "Done" button.

![Unblocking popups](https://github.com/CiscoDevNet/data-dev-learning-labs/blob/master/labs/vizualize-csv-tableau/assets/images/unblock_popups_screen.png?raw=true)

After finishing the above steps, user need to select the source file (network_origin.csv) again and Click on <b>Visualize</b> button as it is described in <b>Step 1</b>.

**Step 3**.  View the data dimensions and measures in a Tableau workbook.

![Tableau workbook](https://github.com/prakdutt/data-dev-learning-labs/blob/master/labs/vizualize-csv-tableau/assets/images/tableau_wkbk.png?raw=true)

**Step 4**. Explore the data with drag and drop operations, and create some report.
For example, if you want to create a report to view how many “UDP” and “ICMP” packages are received in each minute, please follow these steps:

	1)	Right click on “receive_time” field.
	2)	Click “Create calculated field …”
	3)	Create a new field named “receive_time_new”, which is generated by apply DATETIME operator to “receive_time” filed 

![Creating a new field](https://github.com/prakdutt/data-dev-learning-labs/blob/master/labs/vizualize-csv-tableau/assets/images/receive_time_new_field.png?raw=true)


	4)	Drag "Number of Records" from "Measures" to "Columns"
	5)	Drag "protocol" field from "Dimensions" to "Rows"
	6) 	Click the "TCP" tag, and then click "Exclude".

![Excluding TCP](https://github.com/CiscoDevNet/data-dev-learning-labs/blob/master/labs/vizualize-csv-tableau/assets/images/MessureSelection11.PNG?raw=true)

	7)	 Drag “receive_time_new” from Dimensions to Rows, and then right click “YEAR(receive_time_new)”, and then select “Minute”,

![Configuring rows](https://github.com/prakdutt/data-dev-learning-labs/blob/master/labs/vizualize-csv-tableau/assets/images/configure_rows.png?raw=true)

	8)  Change the "Marks" type from "Automatic" to "Bar" type. The final report looks like the following example. 
![Final report](https://github.com/CiscoDevNet/data-dev-learning-labs/blob/master/labs/vizualize-csv-tableau/assets/images/ChartTypeSelection.PNG?raw=true)

</br>
After selecting the "Bar" as <b>Marks</b> type, the final output would be like below:
![Final report](https://github.com/CiscoDevNet/data-dev-learning-labs/blob/master/labs/vizualize-csv-tableau/assets/images/MessureSelection1.PNG?raw=true)
(The pop-up may be blocked in browser configuration. Click on the red pop up blocker icon and select <b>Always allow pop-up from http://xxx.xxx.xxx.xxx </b> and click on <b>Done</b> button.) </br> 

![alt-tag](https://github.com/CiscoDevNet/data-dev-learning-labs/blob/master/labs/data-explore-using-zeppelin/assets/popUpBlockerAllowed.PNG?raw=true)

###### Step 9:
On enabling the pop-up, Zeppelin would open in a new window taking the user to Zeppelin home page. Create your own notebook by clicking on <b>Create new note</b> as shown in screenshot below.

![Figure](https://github.com/CiscoDevNet/data-dev-learning-labs/blob/master/labs/data-explore-using-zeppelin/assets/welcome-to-zeppelin.PNG?raw=true)

###### Step 10:

Provide a name to the notebook being created in the pop-up window shown.

![Figure](https://github.com/lpalamth/data-dev-learning-labs/blob/master/labs/data-explore-using-zeppelin/assets/TryZeppelin.jpeg?raw=true)

###### Step 11:

The Zeppelin interactive,development and visualisation environment is ready for use and would look as shown in screenshot below:

![Figure](https://github.com/lpalamth/data-dev-learning-labs/blob/master/labs/data-explore-using-zeppelin/assets/Try Zeppelin 2.jpeg?raw=true)

###### Step 12:

We will use code written in Apache Spark to create resilient distributed dataset (RDD) on bank-full.csv file in this step. The file bank-full.csv is already loaded in Hadoop environment.</br>

The code is as follows:
```jason
val bankText = sc.textFile("hdfs://xx.xx.xx.xx:xxxx/yourPath/bank/bank-full.csv")  
//Replace the bank-full.csv file path.

case class Bank(age:Integer, job:String, marital : String, education : String, balance : Integer)

// split each line, filter out header (starts with "age"), and map it into Bank case class
 
val bank = bankText.map(s=>s.split(";")).filter(s=>s(0)!="\"age\"").map(  
       s=>Bank(s(0).toInt, 
            s(1).replaceAll("\"", ""),  
            s(2).replaceAll("\"", ""),  
            s(3).replaceAll("\"", ""),  
            s(5).replaceAll("\"", "").toInt  
        )  
)
bank.toDF().registerTempTable("bank")
```

Following functions are being done by the Spark Code :

-    Header removal using filter function and data transformation from csv format into RDD of Bank objects.
-    RDD conversion to DataFrame and temporary table creation with name “bank”.
</br>

###### Step 13:

Copy the Apache Spark code to the Zeppelin notebook created in previous step. This will help to load the data file from Hadoop.

In the code, replace the bank-full.csv file path. The path to be replaced can be obtained from the DLP landing page as shown in screenshot below:

![Figure](https://github.com/lpalamth/data-dev-learning-labs/blob/master/labs/data-explore-using-zeppelin/assets/Bank file path.jpeg?raw=true)

Copy the path from DLP landing page(see the screenshot above) and replace with the same in Zeppelin notebook as shown in the screenshot below:

![alt-tag](https://github.com/CiscoDevNet/data-dev-learning-labs/blob/master/labs/data-explore-using-zeppelin/assets/sparkCode.png?raw=true)

###### Step 14:

After replacing the bank-full.csv file path in Zeppelin, Execute the code by clicking on the icon highlighted as shown in screenshot below:

![Figure](https://github.com/lpalamth/data-dev-learning-labs/blob/master/labs/data-explore-using-zeppelin/assets/Try Zeppelin 3.jpeg?raw=true)
</br>

###### Step 15:

On successful execution of code, the screen would be as shown in the screenshot below:

The icon changed to Finished and there would not be any errors shown on the screen.

Below screen is showing that the spark RDD is created successfully and creation of a temporary table name "bank" is also done.
![Figure](https://github.com/lpalamth/data-dev-learning-labs/blob/master/labs/data-explore-using-zeppelin/assets/Try Zeppelin 4.jpeg?raw=true)

###### Step 16:

We have now completed the data loading process. We will use SQL queries in Zeppelin to retrieve and visualize the data loaded. Let's try a few examples to visualize the data in Zeppelin.

<b>Example 1:</b> Age distribution of data that is stored in bank RDD. 
</br>
Copy the below query to Zeppelin Editor and execute the same.

```sql
%sql 
select age, count(1) from bank where age < 30 group by age order by age
```

Change the graph type to pie chart and view the output as shown below:

![alt-tag](https://github.com/lpalamth/data-dev-learning-labs/blob/master/labs/data-explore-using-zeppelin/assets/Example1_Pie.jpeg?raw=true)


<b>Example 2:</b> Input run-time data as input box and display output. 

Copy the below query to Zeppelin Editor and execute the same.

```sql
%sql
select age, count(1) from bank where age < ${maxAge=30} group by age order by age
```

![alt-tag](https://github.com/lpalamth/data-dev-learning-labs/blob/master/labs/data-explore-using-zeppelin/assets/Example 2.jpeg?raw=true)
</br>

Enter value as 28 in the input box, select graph type as pie chart and view the output as shown below.

![alt-tag](https://github.com/lpalamth/data-dev-learning-labs/blob/master/labs/data-explore-using-zeppelin/assets/Example2_pie.jpeg?raw=true)



<b>Example 3:</b> Using dynamic sql query to select data from a drop down list box. 

Copy the below query to Zeppelin Editor and execute the same.

```sql
%sql
select age, count(1) from bank where marital = "${marital=single,single|divorced|married}" group by age order by age
```
The output displays the age distribution with marital status and a combo box to select marital status as shown in the screenshot below:

![alt-tag](https://github.com/lpalamth/data-dev-learning-labs/blob/master/labs/data-explore-using-zeppelin/assets/Example3.jpeg?raw=true)

Select value as "Married" from the combo box, select graph type as "Graph" and view the output as shown below:

![alt-tag](https://github.com/lpalamth/data-dev-learning-labs/blob/master/labs/data-explore-using-zeppelin/assets/Example3_Graph.jpeg?raw=true)

# <center>Congratulations! You have successfully completed the static data interpretation, analysis and visualization using Apache Zeppelin learning lab!
